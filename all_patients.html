{% extends "base.html" %}
{% block content %}
<h2>All Patients</h2>
<table class="table table-striped" id="allTable">
  <thead></thead>
  <tbody></tbody>
</table>

<script>
async function loadAll(){
  try {
    const res = await fetch('/api/patients');
    console.log('API response status:', res.status);
    const data = await res.json();
    console.log('API data:', data);

    const table = document.getElementById('allTable');
    table.tHead.innerHTML = '';
    table.tBodies[0].innerHTML = '';

    if(!Array.isArray(data) || data.length === 0){
      table.tBodies[0].innerHTML = '<tr><td colspan="13">No data</td></tr>';
      return;
    }

    const headers = ['Patient_ID', ...Object.keys(data[0]).filter(k => k !== 'Patient_ID')];
    const headerRow = document.createElement('tr');
    headers.forEach(k => {
      const th = document.createElement('th');
      th.innerText = k;
      headerRow.appendChild(th);
    });
    table.tHead.appendChild(headerRow);

    data.forEach(row => {
      const tr = document.createElement('tr');
      headers.forEach(h => {
        const td = document.createElement('td');
        td.innerText = row[h] || '';
        tr.appendChild(td);
      });
      table.tBodies[0].appendChild(tr);
    });

  } catch(err) {
    console.error('Error loading all patients:', err);
    const table = document.getElementById('allTable');
    table.tBodies[0].innerHTML = '<tr><td colspan="13">Error loading data</td></tr>';
  }
}

loadAll();

</script>
{% endblock %}

